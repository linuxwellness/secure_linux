rule win_vskimmer_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.vskimmer."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.vskimmer"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 50 ffb598fbffff 8d8d28fbffff e8???????? }
            // n = 4, score = 100
            //   50                   | push                eax
            //   ffb598fbffff         | push                dword ptr [ebp - 0x468]
            //   8d8d28fbffff         | lea                 ecx, [ebp - 0x4d8]
            //   e8????????           |                     

        $sequence_1 = { 53 ff750c ff4508 ff7508 8d85acfdffff 50 8d8db4fdffff }
            // n = 7, score = 100
            //   53                   | push                ebx
            //   ff750c               | push                dword ptr [ebp + 0xc]
            //   ff4508               | inc                 dword ptr [ebp + 8]
            //   ff7508               | push                dword ptr [ebp + 8]
            //   8d85acfdffff         | lea                 eax, [ebp - 0x254]
            //   50                   | push                eax
            //   8d8db4fdffff         | lea                 ecx, [ebp - 0x24c]

        $sequence_2 = { 8d85ecfeffff 50 8d8d80faffff e8???????? 8b8530fbffff 2b852cfbffff }
            // n = 6, score = 100
            //   8d85ecfeffff         | lea                 eax, [ebp - 0x114]
            //   50                   | push                eax
            //   8d8d80faffff         | lea                 ecx, [ebp - 0x580]
            //   e8????????           |                     
            //   8b8530fbffff         | mov                 eax, dword ptr [ebp - 0x4d0]
            //   2b852cfbffff         | sub                 eax, dword ptr [ebp - 0x4d4]

        $sequence_3 = { 7513 b001 e9???????? 8933 897b04 32c0 e9???????? }
            // n = 7, score = 100
            //   7513                 | jne                 0x15
            //   b001                 | mov                 al, 1
            //   e9????????           |                     
            //   8933                 | mov                 dword ptr [ebx], esi
            //   897b04               | mov                 dword ptr [ebx + 4], edi
            //   32c0                 | xor                 al, al
            //   e9????????           |                     

        $sequence_4 = { e8???????? ff7508 8b10 8bc8 ff5208 8b4e10 884508 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   ff7508               | push                dword ptr [ebp + 8]
            //   8b10                 | mov                 edx, dword ptr [eax]
            //   8bc8                 | mov                 ecx, eax
            //   ff5208               | call                dword ptr [edx + 8]
            //   8b4e10               | mov                 ecx, dword ptr [esi + 0x10]
            //   884508               | mov                 byte ptr [ebp + 8], al

        $sequence_5 = { 56 8b7508 85f6 741b 57 8bfe ff770c }
            // n = 7, score = 100
            //   56                   | push                esi
            //   8b7508               | mov                 esi, dword ptr [ebp + 8]
            //   85f6                 | test                esi, esi
            //   741b                 | je                  0x1d
            //   57                   | push                edi
            //   8bfe                 | mov                 edi, esi
            //   ff770c               | push                dword ptr [edi + 0xc]

        $sequence_6 = { 2b4510 8b4d0c 3bc8 7202 8bc8 837e1410 7204 }
            // n = 7, score = 100
            //   2b4510               | sub                 eax, dword ptr [ebp + 0x10]
            //   8b4d0c               | mov                 ecx, dword ptr [ebp + 0xc]
            //   3bc8                 | cmp                 ecx, eax
            //   7202                 | jb                  4
            //   8bc8                 | mov                 ecx, eax
            //   837e1410             | cmp                 dword ptr [esi + 0x14], 0x10
            //   7204                 | jb                  6

        $sequence_7 = { e8???????? 8bce 5e e9???????? 55 8bec 8b4120 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   8bce                 | mov                 ecx, esi
            //   5e                   | pop                 esi
            //   e9????????           |                     
            //   55                   | push                ebp
            //   8bec                 | mov                 ebp, esp
            //   8b4120               | mov                 eax, dword ptr [ecx + 0x20]

        $sequence_8 = { 897de8 895de4 885dd4 e8???????? c745fc01000000 ebb0 6a0f }
            // n = 7, score = 100
            //   897de8               | mov                 dword ptr [ebp - 0x18], edi
            //   895de4               | mov                 dword ptr [ebp - 0x1c], ebx
            //   885dd4               | mov                 byte ptr [ebp - 0x2c], bl
            //   e8????????           |                     
            //   c745fc01000000       | mov                 dword ptr [ebp - 4], 1
            //   ebb0                 | jmp                 0xffffffb2
            //   6a0f                 | push                0xf

        $sequence_9 = { 33d2 42 d3e2 8b4f04 }
            // n = 4, score = 100
            //   33d2                 | xor                 edx, edx
            //   42                   | inc                 edx
            //   d3e2                 | shl                 edx, cl
            //   8b4f04               | mov                 ecx, dword ptr [edi + 4]

    condition:
        7 of them and filesize < 376832
}