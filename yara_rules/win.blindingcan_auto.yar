rule win_blindingcan_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.blindingcan."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.blindingcan"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { c745e4ef0dfff5 c745e85acd9c1d c745ec36c2f964 c745f0a70d9fae c745f48f2aedf1 }
            // n = 5, score = 300
            //   c745e4ef0dfff5       | mov                 dword ptr [ebp - 0x1c], 0xf5ff0def
            //   c745e85acd9c1d       | mov                 dword ptr [ebp - 0x18], 0x1d9ccd5a
            //   c745ec36c2f964       | mov                 dword ptr [ebp - 0x14], 0x64f9c236
            //   c745f0a70d9fae       | mov                 dword ptr [ebp - 0x10], 0xae9f0da7
            //   c745f48f2aedf1       | mov                 dword ptr [ebp - 0xc], 0xf1ed2a8f

        $sequence_1 = { c785f0fcffffb219e08f c785f4fcffff7939d39d c785f8fcffffe25fcedf c785fcfcfffff15112b2 c78500fdffffc2840aa6 c78504fdfffff79d6681 c78508fdffffbfa7f8a5 }
            // n = 7, score = 300
            //   c785f0fcffffb219e08f     | mov    dword ptr [ebp - 0x310], 0x8fe019b2
            //   c785f4fcffff7939d39d     | mov    dword ptr [ebp - 0x30c], 0x9dd33979
            //   c785f8fcffffe25fcedf     | mov    dword ptr [ebp - 0x308], 0xdfce5fe2
            //   c785fcfcfffff15112b2     | mov    dword ptr [ebp - 0x304], 0xb21251f1
            //   c78500fdffffc2840aa6     | mov    dword ptr [ebp - 0x300], 0xa60a84c2
            //   c78504fdfffff79d6681     | mov    dword ptr [ebp - 0x2fc], 0x81669df7
            //   c78508fdffffbfa7f8a5     | mov    dword ptr [ebp - 0x2f8], 0xa5f8a7bf

        $sequence_2 = { c78578feffffb90fec33 c7857cfeffff36a54e6b c78580feffff5c01611e c78584feffffb5dcfc68 c78588feffff6ce7a33a }
            // n = 5, score = 300
            //   c78578feffffb90fec33     | mov    dword ptr [ebp - 0x188], 0x33ec0fb9
            //   c7857cfeffff36a54e6b     | mov    dword ptr [ebp - 0x184], 0x6b4ea536
            //   c78580feffff5c01611e     | mov    dword ptr [ebp - 0x180], 0x1e61015c
            //   c78584feffffb5dcfc68     | mov    dword ptr [ebp - 0x17c], 0x68fcdcb5
            //   c78588feffff6ce7a33a     | mov    dword ptr [ebp - 0x178], 0x3aa3e76c

        $sequence_3 = { c78520feffff879d0358 c78524feffffa1e40f11 c78528feffff91d87472 c7852cfeffff05d2ecb6 }
            // n = 4, score = 300
            //   c78520feffff879d0358     | mov    dword ptr [ebp - 0x1e0], 0x58039d87
            //   c78524feffffa1e40f11     | mov    dword ptr [ebp - 0x1dc], 0x110fe4a1
            //   c78528feffff91d87472     | mov    dword ptr [ebp - 0x1d8], 0x7274d891
            //   c7852cfeffff05d2ecb6     | mov    dword ptr [ebp - 0x1d4], 0xb6ecd205

        $sequence_4 = { c745a8ef9300aa c745ac84b1df57 c745b0c8cbfee9 c745b4567e337f c745b8e958e686 }
            // n = 5, score = 300
            //   c745a8ef9300aa       | mov                 dword ptr [ebp - 0x58], 0xaa0093ef
            //   c745ac84b1df57       | mov                 dword ptr [ebp - 0x54], 0x57dfb184
            //   c745b0c8cbfee9       | mov                 dword ptr [ebp - 0x50], 0xe9fecbc8
            //   c745b4567e337f       | mov                 dword ptr [ebp - 0x4c], 0x7f337e56
            //   c745b8e958e686       | mov                 dword ptr [ebp - 0x48], 0x86e658e9

        $sequence_5 = { c78548ffffffcc055897 c7854cffffff7c1e00d1 c78550ffffffcc3e05db c78554ffffffadda5315 c78558ffffffc1f11e5e c7855cffffff4baab99c }
            // n = 6, score = 300
            //   c78548ffffffcc055897     | mov    dword ptr [ebp - 0xb8], 0x975805cc
            //   c7854cffffff7c1e00d1     | mov    dword ptr [ebp - 0xb4], 0xd1001e7c
            //   c78550ffffffcc3e05db     | mov    dword ptr [ebp - 0xb0], 0xdb053ecc
            //   c78554ffffffadda5315     | mov    dword ptr [ebp - 0xac], 0x1553daad
            //   c78558ffffffc1f11e5e     | mov    dword ptr [ebp - 0xa8], 0x5e1ef1c1
            //   c7855cffffff4baab99c     | mov    dword ptr [ebp - 0xa4], 0x9cb9aa4b

        $sequence_6 = { c745d87b772e76 c745dc62a9f6c4 c745e0d29c1f7b c745e4ef0dfff5 }
            // n = 4, score = 300
            //   c745d87b772e76       | mov                 dword ptr [ebp - 0x28], 0x762e777b
            //   c745dc62a9f6c4       | mov                 dword ptr [ebp - 0x24], 0xc4f6a962
            //   c745e0d29c1f7b       | mov                 dword ptr [ebp - 0x20], 0x7b1f9cd2
            //   c745e4ef0dfff5       | mov                 dword ptr [ebp - 0x1c], 0xf5ff0def

        $sequence_7 = { 03f7 6bf61a 03c3 03f0 }
            // n = 4, score = 300
            //   03f7                 | add                 esi, edi
            //   6bf61a               | imul                esi, esi, 0x1a
            //   03c3                 | add                 eax, ebx
            //   03f0                 | add                 esi, eax

        $sequence_8 = { 99 f7fe 8bca e8???????? 85c0 7409 }
            // n = 6, score = 200
            //   99                   | cdq                 
            //   f7fe                 | idiv                esi
            //   8bca                 | mov                 ecx, edx
            //   e8????????           |                     
            //   85c0                 | test                eax, eax
            //   7409                 | je                  0xb

        $sequence_9 = { 488b0d???????? e9???????? 4c8d2532470100 488b0d???????? eb7c 4c8d251a470100 488b0d???????? }
            // n = 7, score = 100
            //   488b0d????????       |                     
            //   e9????????           |                     
            //   4c8d2532470100       | inc                 ecx
            //   488b0d????????       |                     
            //   eb7c                 | mov                 edi, ebp
            //   4c8d251a470100       | cdq                 
            //   488b0d????????       |                     

        $sequence_10 = { ff15???????? 8bc8 e8???????? e8???????? 418bfd 99 f7fe }
            // n = 7, score = 100
            //   ff15????????         |                     
            //   8bc8                 | movzx               eax, byte ptr [eax + 0x1ad10]
            //   e8????????           |                     
            //   e8????????           |                     
            //   418bfd               | shl                 edx, 8
            //   99                   | xor                 edx, eax
            //   f7fe                 | mov                 ecx, eax

        $sequence_11 = { 752a 4c8d055edb0000 8bd7 498bcd e8???????? 85c0 7415 }
            // n = 7, score = 100
            //   752a                 | idiv                esi
            //   4c8d055edb0000       | dec                 esp
            //   8bd7                 | lea                 esp, [0x14732]
            //   498bcd               | jmp                 0x7e
            //   e8????????           |                     
            //   85c0                 | dec                 esp
            //   7415                 | lea                 esp, [0x1471a]

        $sequence_12 = { 4533c9 ba000000c0 4489442420 ff15???????? 488bf0 483bc7 752d }
            // n = 7, score = 100
            //   4533c9               | mov                 dword ptr [esp + 0x58], edi
            //   ba000000c0           | dec                 eax
            //   4489442420           | lea                 ecx, [ebp - 0x3f]
            //   ff15????????         |                     
            //   488bf0               | xor                 edx, edx
            //   483bc7               | dec                 esp
            //   752d                 | lea                 ebx, [esp + 0x860]

        $sequence_13 = { e8???????? 4c8d9c2460080000 498b5b38 498b6b40 498b7348 498be3 415f }
            // n = 7, score = 100
            //   e8????????           |                     
            //   4c8d9c2460080000     | dec                 ecx
            //   498b5b38             | mov                 ecx, ebp
            //   498b6b40             | test                eax, eax
            //   498b7348             | je                  0x19
            //   498be3               | dec                 eax
            //   415f                 | mov                 ecx, ebx

        $sequence_14 = { c1e208 420fb6842110ad0100 33d0 410fb6c2 420fb6842010ad0100 c1e208 33d0 }
            // n = 7, score = 100
            //   c1e208               | shl                 edx, 8
            //   420fb6842110ad0100     | inc    edx
            //   33d0                 | movzx               eax, byte ptr [ecx + 0x1ad10]
            //   410fb6c2             | xor                 edx, eax
            //   420fb6842010ad0100     | inc    ecx
            //   c1e208               | movzx               eax, dl
            //   33d0                 | inc                 edx

        $sequence_15 = { e8???????? 488bcb 897c2458 e8???????? 488d4dc1 33d2 }
            // n = 6, score = 100
            //   e8????????           |                     
            //   488bcb               | jne                 0x2c
            //   897c2458             | dec                 esp
            //   e8????????           |                     
            //   488d4dc1             | lea                 eax, [0xdb5e]
            //   33d2                 | mov                 edx, edi

    condition:
        7 of them and filesize < 363520
}