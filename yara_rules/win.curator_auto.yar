rule win_curator_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.curator."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.curator"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { e8???????? 488d15e1190300 488d4de0 e8???????? cc ff15???????? 0fb7d0 }
            // n = 7, score = 200
            //   e8????????           |                     
            //   488d15e1190300       | rol                 ecx, 0x15
            //   488d4de0             | mov                 dword ptr [edx + 0x24], ecx
            //   e8????????           |                     
            //   cc                   | punpckhqdq          xmm7, xmm7
            //   ff15????????         |                     
            //   0fb7d0               | movd                ecx, xmm7

        $sequence_1 = { 490bc9 4b898cd300e50800 49ffc2 4981fa00010000 7ca4 }
            // n = 5, score = 200
            //   490bc9               | dec                 eax
            //   4b898cd300e50800     | mov                 ecx, ebx
            //   49ffc2               | dec                 eax
            //   4981fa00010000       | mov                 ecx, eax
            //   7ca4                 | dec                 eax

        $sequence_2 = { 488d157f830500 488d4c2428 e8???????? 90 488d542428 488d4c2450 }
            // n = 6, score = 200
            //   488d157f830500       | mov                 dword ptr [ebx], eax
            //   488d4c2428           | dec                 eax
            //   e8????????           |                     
            //   90                   | mov                 eax, ebx
            //   488d542428           | dec                 eax
            //   488d4c2450           | add                 esp, 0x20

        $sequence_3 = { 498bcc ff5230 33ed 84c0 0f84d4000000 8b442430 483bd8 }
            // n = 7, score = 200
            //   498bcc               | add                 ecx, edx
            //   ff5230               | jmp                 0x28f
            //   33ed                 | xor                 ecx, ecx
            //   84c0                 | dec                 eax
            //   0f84d4000000         | mov                 dword ptr [edx + 0x60], ecx
            //   8b442430             | dec                 eax
            //   483bd8               | mov                 edx, dword ptr [edi + 0xa8]

        $sequence_4 = { f30f6f0c0a 488d4940 660f380005???????? 660f38000d???????? f30f7f41b0 f30f6f440ad0 }
            // n = 6, score = 200
            //   f30f6f0c0a           | dec                 esp
            //   488d4940             | mov                 edi, eax
            //   660f380005????????     |     
            //   660f38000d????????     |     
            //   f30f7f41b0           | dec                 eax
            //   f30f6f440ad0         | add                 ecx, 0x44c8

        $sequence_5 = { 8b511c b840000000 48f7e2 49c7c5ffffffff 490f40c5 488bc8 }
            // n = 6, score = 200
            //   8b511c               | sar                 edx, cl
            //   b840000000           | cmp                 edx, dword ptr [ebx + 0x8c]
            //   48f7e2               | test                eax, eax
            //   49c7c5ffffffff       | jle                 0x698
            //   490f40c5             | inc                 ecx
            //   488bc8               | mov                 ecx, dword ptr [eax + 0xa4]

        $sequence_6 = { 740d 488b01 488b4030 ff15???????? 488b4b08 4885c9 740d }
            // n = 7, score = 200
            //   740d                 | pxor                mm4, qword ptr [esp + 0x90]
            //   488b01               | pxor                xmm0, xmm3
            //   488b4030             | pxor                xmm4, xmm7
            //   ff15????????         |                     
            //   488b4b08             | inc                 bp
            //   4885c9               | pxor                mm0, mm3
            //   740d                 | inc                 bp

        $sequence_7 = { 4889742418 57 4883ec20 488bd9 488d0543110200 488901 8b4210 }
            // n = 7, score = 200
            //   4889742418           | push                ebp
            //   57                   | push                esi
            //   4883ec20             | push                edi
            //   488bd9               | dec                 eax
            //   488d0543110200       | mov                 ebp, esp
            //   488901               | dec                 eax
            //   8b4210               | sub                 esp, 0x60

        $sequence_8 = { 492bd0 4c8bd9 4d2bd8 6690 f30f6f40f0 4883c608 f30f6f4c02f0 }
            // n = 7, score = 200
            //   492bd0               | je                  0x2fc
            //   4c8bd9               | dec                 eax
            //   4d2bd8               | lea                 ebx, [ecx + 8]
            //   6690                 | dec                 eax
            //   f30f6f40f0           | mov                 ecx, ebx
            //   4883c608             | dec                 eax
            //   f30f6f4c02f0         | arpl                ax, di

        $sequence_9 = { e8???????? 488d15c3920200 488d4c2438 e8???????? cc 488d4c2438 e8???????? }
            // n = 7, score = 200
            //   e8????????           |                     
            //   488d15c3920200       | mov                 eax, dword ptr [esp + 0x60]
            //   488d4c2438           | mov                 dword ptr [edi + 0x1f0], eax
            //   e8????????           |                     
            //   cc                   | rol                 eax, 8
            //   488d4c2438           | inc                 ebp
            //   e8????????           |                     

    condition:
        7 of them and filesize < 1265664
}