rule win_unidentified_081_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.unidentified_081."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.unidentified_081"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 5d c3 8b04c58c434100 5d c3 55 8bec }
            // n = 7, score = 100
            //   5d                   | pop                 ebp
            //   c3                   | ret                 
            //   8b04c58c434100       | mov                 eax, dword ptr [eax*8 + 0x41438c]
            //   5d                   | pop                 ebp
            //   c3                   | ret                 
            //   55                   | push                ebp
            //   8bec                 | mov                 ebp, esp

        $sequence_1 = { 83fe10 7ce1 83fe10 752f eb29 }
            // n = 5, score = 100
            //   83fe10               | cmp                 esi, 0x10
            //   7ce1                 | jl                  0xffffffe3
            //   83fe10               | cmp                 esi, 0x10
            //   752f                 | jne                 0x31
            //   eb29                 | jmp                 0x2b

        $sequence_2 = { 8d901cb74100 5f 668b02 8d5202 668901 8d4902 4f }
            // n = 7, score = 100
            //   8d901cb74100         | lea                 edx, [eax + 0x41b71c]
            //   5f                   | pop                 edi
            //   668b02               | mov                 ax, word ptr [edx]
            //   8d5202               | lea                 edx, [edx + 2]
            //   668901               | mov                 word ptr [ecx], ax
            //   8d4902               | lea                 ecx, [ecx + 2]
            //   4f                   | dec                 edi

        $sequence_3 = { 7423 68???????? ff15???????? ff05???????? 68???????? ff15???????? }
            // n = 6, score = 100
            //   7423                 | je                  0x25
            //   68????????           |                     
            //   ff15????????         |                     
            //   ff05????????         |                     
            //   68????????           |                     
            //   ff15????????         |                     

        $sequence_4 = { 7d10 668b444b0c 6689044da4d14100 41 ebe8 8bce }
            // n = 6, score = 100
            //   7d10                 | jge                 0x12
            //   668b444b0c           | mov                 ax, word ptr [ebx + ecx*2 + 0xc]
            //   6689044da4d14100     | mov                 word ptr [ecx*2 + 0x41d1a4], ax
            //   41                   | inc                 ecx
            //   ebe8                 | jmp                 0xffffffea
            //   8bce                 | mov                 ecx, esi

        $sequence_5 = { 0fb605???????? 884103 0fb605???????? 884104 0fb605???????? 884105 0fb605???????? }
            // n = 7, score = 100
            //   0fb605????????       |                     
            //   884103               | mov                 byte ptr [ecx + 3], al
            //   0fb605????????       |                     
            //   884104               | mov                 byte ptr [ecx + 4], al
            //   0fb605????????       |                     
            //   884105               | mov                 byte ptr [ecx + 5], al
            //   0fb605????????       |                     

        $sequence_6 = { 3b02 752a 83c104 83c204 83ee04 }
            // n = 5, score = 100
            //   3b02                 | cmp                 eax, dword ptr [edx]
            //   752a                 | jne                 0x2c
            //   83c104               | add                 ecx, 4
            //   83c204               | add                 edx, 4
            //   83ee04               | sub                 esi, 4

        $sequence_7 = { 8d9b00000000 0fb70c73 8d41d0 6683f809 7705 80e930 eb1e }
            // n = 7, score = 100
            //   8d9b00000000         | lea                 ebx, [ebx]
            //   0fb70c73             | movzx               ecx, word ptr [ebx + esi*2]
            //   8d41d0               | lea                 eax, [ecx - 0x30]
            //   6683f809             | cmp                 ax, 9
            //   7705                 | ja                  7
            //   80e930               | sub                 cl, 0x30
            //   eb1e                 | jmp                 0x20

        $sequence_8 = { ff7318 68???????? 68???????? e8???????? eb2b 68???????? 6804010000 }
            // n = 7, score = 100
            //   ff7318               | push                dword ptr [ebx + 0x18]
            //   68????????           |                     
            //   68????????           |                     
            //   e8????????           |                     
            //   eb2b                 | jmp                 0x2d
            //   68????????           |                     
            //   6804010000           | push                0x104

        $sequence_9 = { 58 668986b8000000 668986be010000 c74668f0b44100 83a6b803000000 }
            // n = 5, score = 100
            //   58                   | pop                 eax
            //   668986b8000000       | mov                 word ptr [esi + 0xb8], ax
            //   668986be010000       | mov                 word ptr [esi + 0x1be], ax
            //   c74668f0b44100       | mov                 dword ptr [esi + 0x68], 0x41b4f0
            //   83a6b803000000       | and                 dword ptr [esi + 0x3b8], 0

    condition:
        7 of them and filesize < 273408
}