rule win_ceeloader_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.ceeloader."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.ceeloader"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 0bd3 3bce 5a 0bff 0bda 8bde 0bd3 }
            // n = 7, score = 100
            //   0bd3                 | inc                 ecx
            //   3bce                 | shl                 edi, 1
            //   5a                   | inc                 esp
            //   0bff                 | mov                 dword ptr [esp + 0x308], edi
            //   0bda                 | inc                 esp
            //   8bde                 | add                 esi, dword ptr [esp + 0x308]
            //   0bd3                 | inc                 esp

        $sequence_1 = { 0bda 8bde 0bd3 3bce 23f3 3bdd 0bda }
            // n = 7, score = 100
            //   0bda                 | mov                 dword ptr [esp + 0x4c], eax
            //   8bde                 | xor                 eax, eax
            //   0bd3                 | mov                 ecx, eax
            //   3bce                 | dec                 eax
            //   23f3                 | mov                 edx, dword ptr [esp + 0x98]
            //   3bdd                 | inc                 ebp
            //   0bda                 | imul                eax, ebx

        $sequence_2 = { 23ca 0bda 8bde 0bd3 3bce 23f3 23f5 }
            // n = 7, score = 100
            //   23ca                 | dec                 eax
            //   0bda                 | mov                 ecx, dword ptr [esp + 0x28]
            //   8bde                 | dec                 eax
            //   0bd3                 | cmp                 dword ptr [ebp - 0x30], ecx
            //   3bce                 | jne                 0x532
            //   23f3                 | dec                 eax
            //   23f5                 | lea                 edx, [0xa9854]

        $sequence_3 = { c78424f020000070da8e98 c7842480240000b56c5edf c78424a42100007b48444d c78424f81f00000b68532d c78424f82100006b7695e5 c7842414220000ea0feaa3 c78424f41d00000d8f5dc6 }
            // n = 7, score = 100
            //   c78424f020000070da8e98     | and    cl, byte ptr [esp + 0x89]
            //   c7842480240000b56c5edf     | inc    esp
            //   c78424a42100007b48444d     | mov    byte ptr [esp + 0x88], cl
            //   c78424f81f00000b68532d     | inc    esp
            //   c78424f82100006b7695e5     | xor    al, byte ptr [esp + 0x88]
            //   c7842414220000ea0feaa3     | inc    esp
            //   c78424f41d00000d8f5dc6     | mov    byte ptr [esp + 0x87], al

        $sequence_4 = { 898c247c120000 698c247c120000cd000000 898c2478120000 8b8c2478120000 c1e90c 898c2474120000 6b8c247412000005 }
            // n = 7, score = 100
            //   898c247c120000       | mov                 byte ptr [esp + 0x24c], cl
            //   698c247c120000cd000000     | xor    ecx, 0x61
            //   898c2478120000       | inc                 ecx
            //   8b8c2478120000       | mov                 cl, cl
            //   c1e90c               | xor                 ecx, 0x68
            //   898c2474120000       | inc                 ecx
            //   6b8c247412000005     | mov                 cl, cl

        $sequence_5 = { 89d1 4889c2 4889442478 4489442474 ff15???????? 4531c0 488d942440030000 }
            // n = 7, score = 100
            //   89d1                 | xor                 eax, eax
            //   4889c2               | mov                 ecx, eax
            //   4889442478           | dec                 eax
            //   4489442474           | mov                 edx, dword ptr [esp + 0xc0]
            //   ff15????????         |                     
            //   4531c0               | dec                 eax
            //   488d942440030000     | mov                 dword ptr [esp + 0x40], ecx

        $sequence_6 = { c1e601 89b42460030000 44039c2460030000 44899c245c030000 448b9c245c030000 41c1eb06 44899c2458030000 }
            // n = 7, score = 100
            //   c1e601               | inc                 ecx
            //   89b42460030000       | shl                 ebx, 4
            //   44039c2460030000     | inc                 esp
            //   44899c245c030000     | mov                 dword ptr [esp + 0x368], ebx
            //   448b9c245c030000     | inc                 esp
            //   41c1eb06             | add                 edx, dword ptr [esp + 0x368]
            //   44899c2458030000     | inc                 ecx

        $sequence_7 = { 4188c9 4180f1ff 44888c24ad000000 448a8c24ad000000 c68424ac00000000 448a9424ac000000 4180f2ff }
            // n = 7, score = 100
            //   4188c9               | dec                 eax
            //   4180f1ff             | cmovne              ecx, edi
            //   44888c24ad000000     | dec                 eax
            //   448a8c24ad000000     | mov                 dword ptr [ebx + 0x48], ecx
            //   c68424ac00000000     | dec                 eax
            //   448a9424ac000000     | mov                 esi, dword ptr [esp + 0x38]
            //   4180f2ff             | mov                 dword ptr [ebx + 0x50], eax

        $sequence_8 = { 0bc2 0bda 8bde 0bd3 3bce 23ca 33f6 }
            // n = 7, score = 100
            //   0bc2                 | inc                 ecx
            //   0bda                 | mov                 edx, 0xf
            //   8bde                 | inc                 esp
            //   0bd3                 | mov                 edx, dword ptr [esp + 0xbc]
            //   3bce                 | inc                 ebp
            //   23ca                 | xor                 eax, edx
            //   33f6                 | mov                 dword ptr [esp + 0x1a4], 0

        $sequence_9 = { 488b942430010000 48898c24a0000000 4889d1 488d1534b20b00 be05000000 448984249c000000 4189f0 }
            // n = 7, score = 100
            //   488b942430010000     | mov                 ebx, esi
            //   48898c24a0000000     | or                  edx, ebx
            //   4889d1               | cmp                 ecx, esi
            //   488d1534b20b00       | cmp                 ebx, ebp
            //   be05000000           | jp                  0xe43
            //   448984249c000000     | or                  ebx, edx
            //   4189f0               | mov                 ebx, esi

    condition:
        7 of them and filesize < 2321408
}