rule win_lokipws_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.lokipws."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.lokipws"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { ff75fc ff35???????? e8???????? 83c44c 6a00 6a01 53 }
            // n = 7, score = 300
            //   ff75fc               | push                dword ptr [ebp - 4]
            //   ff35????????         |                     
            //   e8????????           |                     
            //   83c44c               | add                 esp, 0x4c
            //   6a00                 | push                0
            //   6a01                 | push                1
            //   53                   | push                ebx

        $sequence_1 = { 58 6a49 6689856affffff 58 6a32 6689856cffffff 33c0 }
            // n = 7, score = 300
            //   58                   | pop                 eax
            //   6a49                 | push                0x49
            //   6689856affffff       | mov                 word ptr [ebp - 0x96], ax
            //   58                   | pop                 eax
            //   6a32                 | push                0x32
            //   6689856cffffff       | mov                 word ptr [ebp - 0x94], ax
            //   33c0                 | xor                 eax, eax

        $sequence_2 = { c78540fdffff00b91000 c78544fdffff0000488b c78548fdffffc60f1f80 899d4cfdffff c78550fdffff4c89304c c78554fdffff8970084c c78558fdffff89701048 }
            // n = 7, score = 300
            //   c78540fdffff00b91000     | mov    dword ptr [ebp - 0x2c0], 0x10b900
            //   c78544fdffff0000488b     | mov    dword ptr [ebp - 0x2bc], 0x8b480000
            //   c78548fdffffc60f1f80     | mov    dword ptr [ebp - 0x2b8], 0x801f0fc6
            //   899d4cfdffff         | mov                 dword ptr [ebp - 0x2b4], ebx
            //   c78550fdffff4c89304c     | mov    dword ptr [ebp - 0x2b0], 0x4c30894c
            //   c78554fdffff8970084c     | mov    dword ptr [ebp - 0x2ac], 0x4c087089
            //   c78558fdffff89701048     | mov    dword ptr [ebp - 0x2a8], 0x48107089

        $sequence_3 = { a5 a5 a5 ff5124 85c0 0f8881000000 395dfc }
            // n = 7, score = 300
            //   a5                   | movsd               dword ptr es:[edi], dword ptr [esi]
            //   a5                   | movsd               dword ptr es:[edi], dword ptr [esi]
            //   a5                   | movsd               dword ptr es:[edi], dword ptr [esi]
            //   ff5124               | call                dword ptr [ecx + 0x24]
            //   85c0                 | test                eax, eax
            //   0f8881000000         | js                  0x87
            //   395dfc               | cmp                 dword ptr [ebp - 4], ebx

        $sequence_4 = { 85c0 750e 50 ff35???????? e8???????? 59 59 }
            // n = 7, score = 300
            //   85c0                 | test                eax, eax
            //   750e                 | jne                 0x10
            //   50                   | push                eax
            //   ff35????????         |                     
            //   e8????????           |                     
            //   59                   | pop                 ecx
            //   59                   | pop                 ecx

        $sequence_5 = { 59 8935???????? 5f 5e 33c0 5b 8be5 }
            // n = 7, score = 300
            //   59                   | pop                 ecx
            //   8935????????         |                     
            //   5f                   | pop                 edi
            //   5e                   | pop                 esi
            //   33c0                 | xor                 eax, eax
            //   5b                   | pop                 ebx
            //   8be5                 | mov                 esp, ebp

        $sequence_6 = { e8???????? 59 83f802 7649 33db 53 6a01 }
            // n = 7, score = 300
            //   e8????????           |                     
            //   59                   | pop                 ecx
            //   83f802               | cmp                 eax, 2
            //   7649                 | jbe                 0x4b
            //   33db                 | xor                 ebx, ebx
            //   53                   | push                ebx
            //   6a01                 | push                1

        $sequence_7 = { e8???????? 83c418 8bf8 68???????? 68???????? 53 85ff }
            // n = 7, score = 300
            //   e8????????           |                     
            //   83c418               | add                 esp, 0x18
            //   8bf8                 | mov                 edi, eax
            //   68????????           |                     
            //   68????????           |                     
            //   53                   | push                ebx
            //   85ff                 | test                edi, edi

        $sequence_8 = { c745acf8870304 c745b04e7f6ec1 c745b40b67c770 c745b87818d318 c745bcc2202182 c745c082df524e c745c4c7724986 }
            // n = 7, score = 300
            //   c745acf8870304       | mov                 dword ptr [ebp - 0x54], 0x40387f8
            //   c745b04e7f6ec1       | mov                 dword ptr [ebp - 0x50], 0xc16e7f4e
            //   c745b40b67c770       | mov                 dword ptr [ebp - 0x4c], 0x70c7670b
            //   c745b87818d318       | mov                 dword ptr [ebp - 0x48], 0x18d31878
            //   c745bcc2202182       | mov                 dword ptr [ebp - 0x44], 0x822120c2
            //   c745c082df524e       | mov                 dword ptr [ebp - 0x40], 0x4e52df82
            //   c745c4c7724986       | mov                 dword ptr [ebp - 0x3c], 0x864972c7

        $sequence_9 = { 83c40c 85db 7411 6a02 53 e8???????? 53 }
            // n = 7, score = 300
            //   83c40c               | add                 esp, 0xc
            //   85db                 | test                ebx, ebx
            //   7411                 | je                  0x13
            //   6a02                 | push                2
            //   53                   | push                ebx
            //   e8????????           |                     
            //   53                   | push                ebx

    condition:
        7 of them and filesize < 1327104
}