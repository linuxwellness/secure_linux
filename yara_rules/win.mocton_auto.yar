rule win_mocton_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.mocton."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.mocton"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 81fa8f995d36 7d0c c7858cfdffff01000000 eb0a c7858cfdffff00000000 8b8d8cfdffff }
            // n = 6, score = 100
            //   81fa8f995d36         | cmp                 edx, 0x365d998f
            //   7d0c                 | jge                 0xe
            //   c7858cfdffff01000000     | mov    dword ptr [ebp - 0x274], 1
            //   eb0a                 | jmp                 0xc
            //   c7858cfdffff00000000     | mov    dword ptr [ebp - 0x274], 0
            //   8b8d8cfdffff         | mov                 ecx, dword ptr [ebp - 0x274]

        $sequence_1 = { 894db4 3bd0 7e0c 8b55f0 81ea6ac46c38 8955f0 eb12 }
            // n = 7, score = 100
            //   894db4               | mov                 dword ptr [ebp - 0x4c], ecx
            //   3bd0                 | cmp                 edx, eax
            //   7e0c                 | jle                 0xe
            //   8b55f0               | mov                 edx, dword ptr [ebp - 0x10]
            //   81ea6ac46c38         | sub                 edx, 0x386cc46a
            //   8955f0               | mov                 dword ptr [ebp - 0x10], edx
            //   eb12                 | jmp                 0x14

        $sequence_2 = { 81f2ba4c89e0 7478 8b854cfcffff 3b854cfcffff 752a 8b8d4cfcffff 83c101 }
            // n = 7, score = 100
            //   81f2ba4c89e0         | xor                 edx, 0xe0894cba
            //   7478                 | je                  0x7a
            //   8b854cfcffff         | mov                 eax, dword ptr [ebp - 0x3b4]
            //   3b854cfcffff         | cmp                 eax, dword ptr [ebp - 0x3b4]
            //   752a                 | jne                 0x2c
            //   8b8d4cfcffff         | mov                 ecx, dword ptr [ebp - 0x3b4]
            //   83c101               | add                 ecx, 1

        $sequence_3 = { 23850ceaffff 0dd13b67de 8b8d0ceaffff 83c101 898d0ceaffff 85c0 0f84e5020000 }
            // n = 7, score = 100
            //   23850ceaffff         | and                 eax, dword ptr [ebp - 0x15f4]
            //   0dd13b67de           | or                  eax, 0xde673bd1
            //   8b8d0ceaffff         | mov                 ecx, dword ptr [ebp - 0x15f4]
            //   83c101               | add                 ecx, 1
            //   898d0ceaffff         | mov                 dword ptr [ebp - 0x15f4], ecx
            //   85c0                 | test                eax, eax
            //   0f84e5020000         | je                  0x2eb

        $sequence_4 = { 7e0c c78584faffff01000000 eb0a c78584faffff00000000 8b8584faffff 250b378f61 3385e8fbffff }
            // n = 7, score = 100
            //   7e0c                 | jle                 0xe
            //   c78584faffff01000000     | mov    dword ptr [ebp - 0x57c], 1
            //   eb0a                 | jmp                 0xc
            //   c78584faffff00000000     | mov    dword ptr [ebp - 0x57c], 0
            //   8b8584faffff         | mov                 eax, dword ptr [ebp - 0x57c]
            //   250b378f61           | and                 eax, 0x618f370b
            //   3385e8fbffff         | xor                 eax, dword ptr [ebp - 0x418]

        $sequence_5 = { 3b4ddc 0f9ec2 0bc2 740b 8b45dc 050000a102 }
            // n = 6, score = 100
            //   3b4ddc               | cmp                 ecx, dword ptr [ebp - 0x24]
            //   0f9ec2               | setle               dl
            //   0bc2                 | or                  eax, edx
            //   740b                 | je                  0xd
            //   8b45dc               | mov                 eax, dword ptr [ebp - 0x24]
            //   050000a102           | add                 eax, 0x2a10000

        $sequence_6 = { 81ca20e2c1fc 339514feffff 899514feffff 6a20 68???????? e8???????? }
            // n = 6, score = 100
            //   81ca20e2c1fc         | or                  edx, 0xfcc1e220
            //   339514feffff         | xor                 edx, dword ptr [ebp - 0x1ec]
            //   899514feffff         | mov                 dword ptr [ebp - 0x1ec], edx
            //   6a20                 | push                0x20
            //   68????????           |                     
            //   e8????????           |                     

        $sequence_7 = { 8b85bcfbffff 83e801 8985bcfbffff 3bca 7f0c c78534faffff01000000 eb0a }
            // n = 7, score = 100
            //   8b85bcfbffff         | mov                 eax, dword ptr [ebp - 0x444]
            //   83e801               | sub                 eax, 1
            //   8985bcfbffff         | mov                 dword ptr [ebp - 0x444], eax
            //   3bca                 | cmp                 ecx, edx
            //   7f0c                 | jg                  0xe
            //   c78534faffff01000000     | mov    dword ptr [ebp - 0x5cc], 1
            //   eb0a                 | jmp                 0xc

        $sequence_8 = { 51 e8???????? 83c40c c745f09c2fa377 c745d444ea32cf c745c89de580ec 8b55d4 }
            // n = 7, score = 100
            //   51                   | push                ecx
            //   e8????????           |                     
            //   83c40c               | add                 esp, 0xc
            //   c745f09c2fa377       | mov                 dword ptr [ebp - 0x10], 0x77a32f9c
            //   c745d444ea32cf       | mov                 dword ptr [ebp - 0x2c], 0xcf32ea44
            //   c745c89de580ec       | mov                 dword ptr [ebp - 0x38], 0xec80e59d
            //   8b55d4               | mov                 edx, dword ptr [ebp - 0x2c]

        $sequence_9 = { c785e4fdffff00000000 8b950cfeffff 2395e4fdffff 339514feffff 81ca892d0130 7412 8b8514feffff }
            // n = 7, score = 100
            //   c785e4fdffff00000000     | mov    dword ptr [ebp - 0x21c], 0
            //   8b950cfeffff         | mov                 edx, dword ptr [ebp - 0x1f4]
            //   2395e4fdffff         | and                 edx, dword ptr [ebp - 0x21c]
            //   339514feffff         | xor                 edx, dword ptr [ebp - 0x1ec]
            //   81ca892d0130         | or                  edx, 0x30012d89
            //   7412                 | je                  0x14
            //   8b8514feffff         | mov                 eax, dword ptr [ebp - 0x1ec]

    condition:
        7 of them and filesize < 573440
}