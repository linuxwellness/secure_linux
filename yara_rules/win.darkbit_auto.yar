rule win_darkbit_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.darkbit."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.darkbit"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { e8???????? 90 c784244e040000a30340b2 c784244a040000f04213e6 31c9 eb1d 0fb6940c4e040000 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   90                   | lea                 ebp, [esp + 0xe0]
            //   c784244e040000a30340b2     | mov    eax, 8
            //   c784244a040000f04213e6     | mov    ecx, 0xb4
            //   31c9                 | dec                 ebp
            //   eb1d                 | cmp                 esp, dword ptr [esi + 0x10]
            //   0fb6940c4e040000     | jbe                 0xb94

        $sequence_1 = { eb10 4889c7 488b8c2408030000 e8???????? 488d0d14e31700 48890d???????? 833d????????00 }
            // n = 7, score = 100
            //   eb10                 | jb                  0xf4e
            //   4889c7               | dec                 eax
            //   488b8c2408030000     | shr                 edx, 8
            //   e8????????           |                     
            //   488d0d14e31700       | dec                 eax
            //   48890d????????       |                     
            //   833d????????00       |                     

        $sequence_2 = { f0480fc113 e8???????? e8???????? 90 90 488d0584cf4e00 e8???????? }
            // n = 7, score = 100
            //   f0480fc113           | jne                 0x1b8
            //   e8????????           |                     
            //   e8????????           |                     
            //   90                   | dec                 eax
            //   90                   | mov                 ecx, eax
            //   488d0584cf4e00       | dec                 eax
            //   e8????????           |                     

        $sequence_3 = { 8b9a38010100 875958 90 bb01000000 488b742470 861e 488b8424a0000000 }
            // n = 7, score = 100
            //   8b9a38010100         | jne                 0x19df
            //   875958               | dec                 esp
            //   90                   | lea                 eax, [ebx + 1]
            //   bb01000000           | nop                 dword ptr [eax]
            //   488b742470           | dec                 esp
            //   861e                 | cmp                 esi, eax
            //   488b8424a0000000     | jae                 0x19d0

        $sequence_4 = { eb1d 440fb64c3418 4129d1 418d51cb 88543c18 418d50cb 88543418 }
            // n = 7, score = 100
            //   eb1d                 | lea                 eax, [0x1548f6]
            //   440fb64c3418         | dec                 eax
            //   4129d1               | mov                 ecx, ebx
            //   418d51cb             | dec                 eax
            //   88543c18             | mov                 ebx, esi
            //   418d50cb             | jae                 0x10b6
            //   88543418             | dec                 eax

        $sequence_5 = { eb1d 488d7808 488b8c24b8020000 e8???????? 488d3df4653a00 e8???????? e8???????? }
            // n = 7, score = 100
            //   eb1d                 | mov                 ecx, esi
            //   488d7808             | dec                 esp
            //   488b8c24b8020000     | mov                 esi, eax
            //   e8????????           |                     
            //   488d3df4653a00       | dec                 eax
            //   e8????????           |                     
            //   e8????????           |                     

        $sequence_6 = { eb0c 488d3d76133c00 e8???????? 90 e8???????? 48891d???????? 833d????????00 }
            // n = 7, score = 100
            //   eb0c                 | xor                 ecx, ecx
            //   488d3d76133c00       | dec                 eax
            //   e8????????           |                     
            //   90                   | mov                 ebx, dword ptr [edx + 0x18]
            //   e8????????           |                     
            //   48891d????????       |                     
            //   833d????????00       |                     

        $sequence_7 = { e8???????? e8???????? 4889c1 4889df 488d0589882c00 488b5c2430 0f1f4000 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   e8????????           |                     
            //   4889c1               | dec                 esp
            //   4889df               | mov                 dword ptr [esp + 0x58], eax
            //   488d0589882c00       | dec                 eax
            //   488b5c2430           | lea                 eax, [0x2b8c86]
            //   0f1f4000             | dec                 ebp

        $sequence_8 = { f34d0fb8db ebd2 4889442438 4c89d8 e8???????? 488b4c2460 488b542430 }
            // n = 7, score = 100
            //   f34d0fb8db           | lea                 edi, [0x4019ea]
            //   ebd2                 | nop                 dword ptr [eax + eax]
            //   4889442438           | jne                 0x129
            //   4c89d8               | jmp                 0x12e
            //   e8????????           |                     
            //   488b4c2460           | dec                 eax
            //   488b542430           | lea                 edi, [0x4372ea]

        $sequence_9 = { eb11 488d7818 488b8c2408140000 e8???????? 488b8c2498050000 48894808 833d????????00 }
            // n = 7, score = 100
            //   eb11                 | dec                 eax
            //   488d7818             | mov                 ecx, dword ptr [esp + 0x18]
            //   488b8c2408140000     | dec                 eax
            //   e8????????           |                     
            //   488b8c2498050000     | mov                 ebx, dword ptr [esp + 0x28]
            //   48894808             | movsd               xmm0, qword ptr [esp + 0x58]
            //   833d????????00       |                     

    condition:
        7 of them and filesize < 11612160
}