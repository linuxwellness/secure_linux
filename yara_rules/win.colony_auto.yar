rule win_colony_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.colony."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.colony"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8bc6 89450c 84d2 7442 3b31 7533 ff7514 }
            // n = 7, score = 600
            //   8bc6                 | jmp                 9
            //   89450c               | mov                 esi, eax
            //   84d2                 | mov                 eax, dword ptr [eax]
            //   7442                 | cmp                 byte ptr [eax + 0xd], 0
            //   3b31                 | je                  0xfffffff4
            //   7533                 | jae                 7
            //   ff7514               | mov                 ecx, dword ptr [ecx + 8]

        $sequence_1 = { 7305 8b4908 eb17 807a0d00 }
            // n = 4, score = 600
            //   7305                 | jae                 4
            //   8b4908               | mov                 edx, ecx
            //   eb17                 | mov                 ebx, ecx
            //   807a0d00             | mov                 ecx, dword ptr [ecx]

        $sequence_2 = { 7302 8bd1 8bd9 8b09 80790d00 }
            // n = 5, score = 600
            //   7302                 | jb                  0xfffffff8
            //   8bd1                 | jmp                 8
            //   8bd9                 | mov                 dword ptr [ebp - 0x118], eax
            //   8b09                 | lea                 eax, [ebp - 0x108]
            //   80790d00             | jb                  0xfffffff8

        $sequence_3 = { 84c0 750a f30f104104 0f5ac0 }
            // n = 4, score = 600
            //   84c0                 | test                al, al
            //   750a                 | movss               xmm1, dword ptr [ecx]
            //   f30f104104           | cvtps2pd            xmm1, xmm1
            //   0f5ac0               | jmp                 0xd

        $sequence_4 = { 72f6 eb06 8985e8feffff 68???????? 68???????? 8d85f8feffff }
            // n = 6, score = 600
            //   72f6                 | lea                 ecx, [0xd68c]
            //   eb06                 | inc                 eax
            //   8985e8feffff         | sete                bh
            //   68????????           |                     
            //   68????????           |                     
            //   8d85f8feffff         | dec                 eax

        $sequence_5 = { 5b c3 b901000000 66894808 }
            // n = 4, score = 600
            //   5b                   | cvtps2pd            xmm0, xmm0
            //   c3                   | jmp                 0x13
            //   b901000000           | movd                xmm0, dword ptr [ecx + 4]
            //   66894808             | cvtdq2pd            xmm0, xmm0

        $sequence_6 = { 803961 7503 c6013b 80383b }
            // n = 4, score = 600
            //   803961               | jne                 0xe
            //   7503                 | movss               xmm0, dword ptr [ecx + 4]
            //   c6013b               | cvtps2pd            xmm0, xmm0
            //   80383b               | test                al, al

        $sequence_7 = { f30f1009 0f5ac9 eb08 660f6e09 f30fe6c9 }
            // n = 5, score = 600
            //   f30f1009             | je                  0x49
            //   0f5ac9               | cmp                 esi, dword ptr [ecx]
            //   eb08                 | jne                 0x3e
            //   660f6e09             | push                dword ptr [ebp + 0x14]
            //   f30fe6c9             | mov                 eax, esi

        $sequence_8 = { 7305 8b4008 eb04 8bc8 8b00 80780d00 74e5 }
            // n = 7, score = 600
            //   7305                 | sub                 edi, eax
            //   8b4008               | lea                 ecx, [ecx + eax*4]
            //   eb04                 | jb                  0xfffffff8
            //   8bc8                 | jmp                 0x43
            //   8b00                 | cmp                 eax, -1
            //   80780d00             | je                  0x43
            //   74e5                 | sub                 edi, eax

        $sequence_9 = { f30f104104 0f5ac0 eb09 660f6e4104 f30fe6c0 }
            // n = 5, score = 600
            //   f30f104104           | cmp                 dword ptr [eax + 4], edi
            //   0f5ac0               | ja                  0x18
            //   eb09                 | mov                 eax, esi
            //   660f6e4104           | mov                 dword ptr [edi + 8], 0
            //   f30fe6c0             | pop                 edi

        $sequence_10 = { 8bc6 c7470800000000 5f 5e }
            // n = 4, score = 600
            //   8bc6                 | cmp                 byte ptr [eax + 0xd], 0
            //   c7470800000000       | je                  0xfffffff4
            //   5f                   | jae                 7
            //   5e                   | mov                 eax, dword ptr [eax + 8]

        $sequence_11 = { f30fe6c9 f30fe6c0 f30fe6d2 660f2fd0 }
            // n = 4, score = 600
            //   f30fe6c9             | movss               xmm0, dword ptr [ecx + 4]
            //   f30fe6c0             | cvtps2pd            xmm0, xmm0
            //   f30fe6d2             | jmp                 0x13
            //   660f2fd0             | movd                xmm0, dword ptr [ecx + 4]

        $sequence_12 = { 8bc8 80790c01 0f8512010000 8b03 }
            // n = 4, score = 600
            //   8bc8                 | jb                  0xfffffff8
            //   80790c01             | jmp                 0x43
            //   0f8512010000         | cmp                 eax, -1
            //   8b03                 | je                  0x43

        $sequence_13 = { 85c0 7407 b901000000 eb0a 33c9 803f01 0f95c1 }
            // n = 7, score = 600
            //   85c0                 | jne                 0xb
            //   7407                 | movss               xmm1, dword ptr [ecx]
            //   b901000000           | cvtps2pd            xmm1, xmm1
            //   eb0a                 | jmp                 0x13
            //   33c9                 | movd                xmm1, dword ptr [ecx]
            //   803f01               | cvtdq2pd            xmm1, xmm1
            //   0f95c1               | test                al, al

        $sequence_14 = { 72f6 eb41 83f8ff 743c }
            // n = 4, score = 600
            //   72f6                 | inc                 ecx
            //   eb41                 | cmp                 eax, edi
            //   83f8ff               | jb                  0xffffff4c
            //   743c                 | jne                 0x2f

        $sequence_15 = { f30fe6c0 84c0 7509 f30f1009 0f5ac9 }
            // n = 5, score = 600
            //   f30fe6c0             | mov                 dword ptr [ebp + 0xc], eax
            //   84c0                 | test                dl, dl
            //   7509                 | je                  0x49
            //   f30f1009             | cmp                 esi, dword ptr [ecx]
            //   0f5ac9               | movzx               eax, cl

        $sequence_16 = { 83f8ff 7526 4c8d35f9f90000 493bde 7408 488bcb e8???????? }
            // n = 7, score = 100
            //   83f8ff               | mov                 ebp, esi
            //   7526                 | cmp                 eax, -1
            //   4c8d35f9f90000       | jne                 0x28
            //   493bde               | dec                 esp
            //   7408                 | lea                 esi, [0xf9f9]
            //   488bcb               | dec                 ecx
            //   e8????????           |                     

        $sequence_17 = { 488905???????? ff15???????? 488d15f3980000 483305???????? 488bcb 488905???????? }
            // n = 6, score = 100
            //   488905????????       |                     
            //   ff15????????         |                     
            //   488d15f3980000       | dec                 eax
            //   483305????????       |                     
            //   488bcb               | cmp                 dword ptr [ecx + 0x138], eax
            //   488905????????       |                     

        $sequence_18 = { e8???????? e9???????? 4c8d25a3fb0000 8bee }
            // n = 4, score = 100
            //   e8????????           |                     
            //   e9????????           |                     
            //   4c8d25a3fb0000       | dec                 esp
            //   8bee                 | lea                 esp, [0xfba3]

        $sequence_19 = { 4c8d0da0d20000 412bc6 413bc7 0f8240ffffff e9???????? }
            // n = 5, score = 100
            //   4c8d0da0d20000       | mov                 ecx, dword ptr [ebx + 0xf8]
            //   412bc6               | dec                 eax
            //   413bc7               | mov                 ecx, dword ptr [ebx + 0x120]
            //   0f8240ffffff         | dec                 eax
            //   e9????????           |                     

        $sequence_20 = { 752d 33c0 4c8d05bfffffff 4533c9 4889442428 }
            // n = 5, score = 100
            //   752d                 | lea                 eax, [0xfc5b]
            //   33c0                 | dec                 eax
            //   4c8d05bfffffff       | cmp                 ecx, eax
            //   4533c9               | je                  0x34
            //   4889442428           | xor                 eax, eax

        $sequence_21 = { 33c0 48398138010000 8bf8 488b442448 488d0d8cd60000 400f94c7 488b0cc1 }
            // n = 7, score = 100
            //   33c0                 | dec                 esp
            //   48398138010000       | lea                 ecx, [0xffff9fdf]
            //   8bf8                 | inc                 ebx
            //   488b442448           | mov                 eax, dword ptr [ecx + eax*4 + 0x6035]
            //   488d0d8cd60000       | dec                 esp
            //   400f94c7             | add                 ecx, eax
            //   488b0cc1             | dec                 eax

        $sequence_22 = { c3 49b90101010101010101 490fafd1 4c8d0ddf9fffff 438b848135600000 4c03c8 }
            // n = 6, score = 100
            //   c3                   | cmp                 ebx, esi
            //   49b90101010101010101     | je    0xa
            //   490fafd1             | dec                 eax
            //   4c8d0ddf9fffff       | mov                 ecx, ebx
            //   438b848135600000     | ret                 
            //   4c03c8               | dec                 ecx

        $sequence_23 = { 488b8bf8000000 e8???????? 488b8b20010000 488d055bfc0000 483bc8 741a }
            // n = 6, score = 100
            //   488b8bf8000000       | mov                 ecx, 0x1010101
            //   e8????????           |                     
            //   488b8b20010000       | add                 dword ptr [ecx], eax
            //   488d055bfc0000       | add                 dword ptr [ecx], eax
            //   483bc8               | dec                 ecx
            //   741a                 | imul                edx, ecx

    condition:
        7 of them and filesize < 7599104
}