rule win_zumanek_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.zumanek."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.zumanek"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { a7 e19b 7cd7 c8563aa3 1f 01b69c6c33a4 }
            // n = 6, score = 100
            //   a7                   | cmpsd               dword ptr [esi], dword ptr es:[edi]
            //   e19b                 | loope               0xffffff9d
            //   7cd7                 | jl                  0xffffffd9
            //   c8563aa3             | enter               0x3a56, -0x5d
            //   1f                   | pop                 ds
            //   01b69c6c33a4         | add                 dword ptr [esi - 0x5bcc9364], esi

        $sequence_1 = { 48 5b 91 6222 69447077897e1285 248c 48 }
            // n = 7, score = 100
            //   48                   | dec                 eax
            //   5b                   | pop                 ebx
            //   91                   | xchg                eax, ecx
            //   6222                 | bound               esp, qword ptr [edx]
            //   69447077897e1285     | imul                eax, dword ptr [eax + esi*2 + 0x77], 0x85127e89
            //   248c                 | and                 al, 0x8c
            //   48                   | dec                 eax

        $sequence_2 = { f2ff11 fa 60 f4 b317 }
            // n = 5, score = 100
            //   f2ff11               | bnd call            dword ptr [ecx]
            //   fa                   | cli                 
            //   60                   | pushal              
            //   f4                   | hlt                 
            //   b317                 | mov                 bl, 0x17

        $sequence_3 = { 38483c 91 40 22444448 4c 895012 }
            // n = 6, score = 100
            //   38483c               | cmp                 byte ptr [eax + 0x3c], cl
            //   91                   | xchg                eax, ecx
            //   40                   | inc                 eax
            //   22444448             | and                 al, byte ptr [esp + eax*2 + 0x48]
            //   4c                   | dec                 esp
            //   895012               | mov                 dword ptr [eax + 0x12], edx

        $sequence_4 = { 6548 7d91 8622 b644 d9f1 89fa }
            // n = 6, score = 100
            //   6548                 | dec                 eax
            //   7d91                 | jge                 0xffffff93
            //   8622                 | xchg                byte ptr [edx], ah
            //   b644                 | mov                 dh, 0x44
            //   d9f1                 | fyl2x               
            //   89fa                 | mov                 edx, edi

        $sequence_5 = { f9 e449 7a1a 3abb62a681d5 50 50 bdb0377c43 }
            // n = 7, score = 100
            //   f9                   | stc                 
            //   e449                 | in                  al, 0x49
            //   7a1a                 | jp                  0x1c
            //   3abb62a681d5         | cmp                 bh, byte ptr [ebx - 0x2a7e599e]
            //   50                   | push                eax
            //   50                   | push                eax
            //   bdb0377c43           | mov                 ebp, 0x437c37b0

        $sequence_6 = { f6400e5a c20f27 92 40 a7 60 22433b }
            // n = 7, score = 100
            //   f6400e5a             | test                byte ptr [eax + 0xe], 0x5a
            //   c20f27               | ret                 0x270f
            //   92                   | xchg                eax, edx
            //   40                   | inc                 eax
            //   a7                   | cmpsd               dword ptr [esi], dword ptr es:[edi]
            //   60                   | pushal              
            //   22433b               | and                 al, byte ptr [ebx + 0x3b]

        $sequence_7 = { 868f72b3a403 61 1d6f8130a3 ed 0138 3423 e5b2 }
            // n = 7, score = 100
            //   868f72b3a403         | xchg                byte ptr [edi + 0x3a4b372], cl
            //   61                   | popal               
            //   1d6f8130a3           | sbb                 eax, 0xa330816f
            //   ed                   | in                  eax, dx
            //   0138                 | add                 dword ptr [eax], edi
            //   3423                 | xor                 al, 0x23
            //   e5b2                 | in                  eax, 0xb2

        $sequence_8 = { 28c9 43 6b3606 be483e8e6c dc91bc8e0891 fb }
            // n = 6, score = 100
            //   28c9                 | sub                 cl, cl
            //   43                   | inc                 ebx
            //   6b3606               | imul                esi, dword ptr [esi], 6
            //   be483e8e6c           | mov                 esi, 0x6c8e3e48
            //   dc91bc8e0891         | fcom                qword ptr [ecx - 0x6ef77144]
            //   fb                   | sti                 

        $sequence_9 = { b997010000 83e905 01c1 53 6a00 53 6a00 }
            // n = 7, score = 100
            //   b997010000           | mov                 ecx, 0x197
            //   83e905               | sub                 ecx, 5
            //   01c1                 | add                 ecx, eax
            //   53                   | push                ebx
            //   6a00                 | push                0
            //   53                   | push                ebx
            //   6a00                 | push                0

    condition:
        7 of them and filesize < 58867712
}