rule win_helminth_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.helminth."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.helminth"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { a1???????? 68e8030000 8907 e8???????? }
            // n = 4, score = 300
            //   a1????????           |                     
            //   68e8030000           | push                0x3e8
            //   8907                 | mov                 dword ptr [edi], eax
            //   e8????????           |                     

        $sequence_1 = { 891d???????? a3???????? c605????????01 57 e8???????? ffb5f0fdffff }
            // n = 6, score = 200
            //   891d????????         |                     
            //   a3????????           |                     
            //   c605????????01       |                     
            //   57                   | push                edi
            //   e8????????           |                     
            //   ffb5f0fdffff         | push                dword ptr [ebp - 0x210]

        $sequence_2 = { 33c0 3b0cc588620110 7427 40 }
            // n = 4, score = 200
            //   33c0                 | xor                 eax, eax
            //   3b0cc588620110       | cmp                 ecx, dword ptr [eax*8 + 0x10016288]
            //   7427                 | je                  0x29
            //   40                   | inc                 eax

        $sequence_3 = { 2bd9 d1fb 3805???????? 7415 }
            // n = 4, score = 200
            //   2bd9                 | sub                 ebx, ecx
            //   d1fb                 | sar                 ebx, 1
            //   3805????????         |                     
            //   7415                 | je                  0x17

        $sequence_4 = { c1e706 8b048570750110 83c00c 03c7 }
            // n = 4, score = 200
            //   c1e706               | shl                 edi, 6
            //   8b048570750110       | mov                 eax, dword ptr [eax*4 + 0x10017570]
            //   83c00c               | add                 eax, 0xc
            //   03c7                 | add                 eax, edi

        $sequence_5 = { 8bc7 c1f805 8bf7 83e61f c1e606 03348570750110 8975dc }
            // n = 7, score = 200
            //   8bc7                 | mov                 eax, edi
            //   c1f805               | sar                 eax, 5
            //   8bf7                 | mov                 esi, edi
            //   83e61f               | and                 esi, 0x1f
            //   c1e606               | shl                 esi, 6
            //   03348570750110       | add                 esi, dword ptr [eax*4 + 0x10017570]
            //   8975dc               | mov                 dword ptr [ebp - 0x24], esi

        $sequence_6 = { 59 59 8b7d08 33db 391cfd50640110 755c 6a18 }
            // n = 7, score = 200
            //   59                   | pop                 ecx
            //   59                   | pop                 ecx
            //   8b7d08               | mov                 edi, dword ptr [ebp + 8]
            //   33db                 | xor                 ebx, ebx
            //   391cfd50640110       | cmp                 dword ptr [edi*8 + 0x10016450], ebx
            //   755c                 | jne                 0x5e
            //   6a18                 | push                0x18

        $sequence_7 = { c705????????00000000 3905???????? 6a00 6a01 ff35???????? 0f94c0 c705????????00000000 }
            // n = 7, score = 200
            //   c705????????00000000     |     
            //   3905????????         |                     
            //   6a00                 | push                0
            //   6a01                 | push                1
            //   ff35????????         |                     
            //   0f94c0               | sete                al
            //   c705????????00000000     |     

        $sequence_8 = { 83e11f c1e106 83c10c 8b048528eb4100 }
            // n = 4, score = 100
            //   83e11f               | and                 ecx, 0x1f
            //   c1e106               | shl                 ecx, 6
            //   83c10c               | add                 ecx, 0xc
            //   8b048528eb4100       | mov                 eax, dword ptr [eax*4 + 0x41eb28]

        $sequence_9 = { 8bf2 a1???????? 894104 33c9 }
            // n = 4, score = 100
            //   8bf2                 | mov                 esi, edx
            //   a1????????           |                     
            //   894104               | mov                 dword ptr [ecx + 4], eax
            //   33c9                 | xor                 ecx, ecx

        $sequence_10 = { 750d 663985eaf9ffff 0f849c000000 68e8030000 e8???????? }
            // n = 5, score = 100
            //   750d                 | jne                 0xf
            //   663985eaf9ffff       | cmp                 word ptr [ebp - 0x616], ax
            //   0f849c000000         | je                  0xa2
            //   68e8030000           | push                0x3e8
            //   e8????????           |                     

        $sequence_11 = { 8bfb 8b45e8 8b4df8 0fb70478 83f80d 740d }
            // n = 6, score = 100
            //   8bfb                 | mov                 edi, ebx
            //   8b45e8               | mov                 eax, dword ptr [ebp - 0x18]
            //   8b4df8               | mov                 ecx, dword ptr [ebp - 8]
            //   0fb70478             | movzx               eax, word ptr [eax + edi*2]
            //   83f80d               | cmp                 eax, 0xd
            //   740d                 | je                  0xf

        $sequence_12 = { ff75f0 ff15???????? 33db 85c0 }
            // n = 4, score = 100
            //   ff75f0               | push                dword ptr [ebp - 0x10]
            //   ff15????????         |                     
            //   33db                 | xor                 ebx, ebx
            //   85c0                 | test                eax, eax

        $sequence_13 = { 56 8bc1 8955f8 57 8bf0 }
            // n = 5, score = 100
            //   56                   | push                esi
            //   8bc1                 | mov                 eax, ecx
            //   8955f8               | mov                 dword ptr [ebp - 8], edx
            //   57                   | push                edi
            //   8bf0                 | mov                 esi, eax

        $sequence_14 = { 75f6 2bca d1f9 83f904 }
            // n = 4, score = 100
            //   75f6                 | jne                 0xfffffff8
            //   2bca                 | sub                 ecx, edx
            //   d1f9                 | sar                 ecx, 1
            //   83f904               | cmp                 ecx, 4

    condition:
        7 of them and filesize < 479232
}