rule win_unidentified_076_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-03-28"
        version = "1"
        description = "Detects win.unidentified_076."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.unidentified_076"
        malpedia_rule_date = "20230328"
        malpedia_hash = "9d2d75cef573c1c2d861f5197df8f563b05a305d"
        malpedia_version = "20230407"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 57 4156 4883ec30 c740086f765f47 c7400c6f340a00 488b81c8000000 488bf9 }
            // n = 7, score = 100
            //   57                   | xor                 edx, edx
            //   4156                 | jg                  0x719
            //   4883ec30             | mov                 ebx, ecx
            //   c740086f765f47       | dec                 eax
            //   c7400c6f340a00       | mov                 dword ptr [esp + 0x20], ecx
            //   488b81c8000000       | inc                 ebp
            //   488bf9               | mov                 ecx, esi

        $sequence_1 = { 4156 4157 4883ec68 488b8110030000 488b9958020000 33f6 }
            // n = 6, score = 100
            //   4156                 | cmp                 eax, 4
            //   4157                 | dec                 eax
            //   4883ec68             | mov                 eax, dword ptr [edi + 0xc8]
            //   488b8110030000       | dec                 eax
            //   488b9958020000       | lea                 ebx, [edi + 0x684]
            //   33f6                 | mov                 ebp, dword ptr [eax + 0x30]

        $sequence_2 = { 7411 33d2 41b800800000 488bce ff9700010000 488b442460 4885c0 }
            // n = 7, score = 100
            //   7411                 | je                  0x1766
            //   33d2                 | inc                 esp
            //   41b800800000         | lea                 ecx, [ebx + 4]
            //   488bce               | inc                 ecx
            //   ff9700010000         | mov                 eax, 0x1000
            //   488b442460           | sub                 ecx, 0xa
            //   4885c0               | je                  0x17cd

        $sequence_3 = { 4c8bf0 4885c0 0f84a1000000 4c8b93c8000000 488d93ac030000 4c8d4de7 4c8d45ff }
            // n = 7, score = 100
            //   4c8bf0               | mov                 word ptr [ebp + 0x58], 0x3b
            //   4885c0               | dec                 eax
            //   0f84a1000000         | test                edx, edx
            //   4c8b93c8000000       | je                  0x174e
            //   488d93ac030000       | dec                 esp
            //   4c8d4de7             | mov                 esp, dword ptr [ecx + 0x228]
            //   4c8d45ff             | dec                 eax

        $sequence_4 = { 498bce ff15???????? 488d0dd46e0000 ff15???????? b9b80b0000 ff15???????? 488b9c2448160000 }
            // n = 7, score = 100
            //   498bce               | test                eax, eax
            //   ff15????????         |                     
            //   488d0dd46e0000       | je                  0x1733
            //   ff15????????         |                     
            //   b9b80b0000           | dec                 esp
            //   ff15????????         |                     
            //   488b9c2448160000     | mov                 eax, dword ptr [esi + 0x250]

        $sequence_5 = { 894374 eb08 48c7437400000000 f6434801 7449 448bc7 }
            // n = 6, score = 100
            //   894374               | mov                 eax, dword ptr [esi + 0xc8]
            //   eb08                 | dec                 eax
            //   48c7437400000000     | lea                 edx, [esi + 0x948]
            //   f6434801             | xor                 edx, edx
            //   7449                 | dec                 ebp
            //   448bc7               | mov                 eax, ebp

        $sequence_6 = { 488b87c8000000 33d2 41b800040000 498bcf ff9020070000 488b87c8000000 33d2 }
            // n = 7, score = 100
            //   488b87c8000000       | mov                 eax, dword ptr [ecx + 0xc8]
            //   33d2                 | inc                 esp
            //   41b800040000         | lea                 eax, [esi + 0x10]
            //   498bcf               | xor                 edx, edx
            //   ff9020070000         | dec                 eax
            //   488b87c8000000       | mov                 edi, ecx
            //   33d2                 | dec                 eax

        $sequence_7 = { 458bc6 33d2 ff9020070000 488d8f18130000 4885c9 7413 }
            // n = 6, score = 100
            //   458bc6               | mov                 edi, ecx
            //   33d2                 | xor                 ecx, ecx
            //   ff9020070000         | mov                 edx, 0x110
            //   488d8f18130000       | push                edi
            //   4885c9               | dec                 eax
            //   7413                 | sub                 esp, 0x20

        $sequence_8 = { e9???????? 89b7c80a0000 39b7d0020000 0f8437050000 498bd5 488bcf }
            // n = 6, score = 100
            //   e9????????           |                     
            //   89b7c80a0000         | inc                 ecx
            //   39b7d0020000         | mov                 ecx, 0x800000
            //   0f8437050000         | mov                 edx, 0x660e
            //   498bd5               | dec                 esp
            //   488bcf               | mov                 dword ptr [esp + 0x20], esi

        $sequence_9 = { 33d2 488d4c2420 448d4240 ff15???????? 4863cb 4903cd }
            // n = 6, score = 100
            //   33d2                 | lea                 eax, [edx + 0x40]
            //   488d4c2420           | dec                 eax
            //   448d4240             | arpl                bx, cx
            //   ff15????????         |                     
            //   4863cb               | dec                 ecx
            //   4903cd               | add                 ecx, ebp

    condition:
        7 of them and filesize < 114688
}